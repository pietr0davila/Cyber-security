O primeiro passo do hacking é identificar o sistema operacional da vítima e quais serviços estão rodando nele. Um serviço é uma aplicação rodando em um computador que faz algo útil. Estamos buscando serviços mal-configurados ou vulneráveis, nossa intenção é usar ele como ponte entre nós e a vítima, por exemplo fazendo um aplicativo com permissões administrativas executar um script malicioso

Computadores tem IPs, que permitem identificação individual de cada dispositivo, das 65.535 portas, da 1 até a 1023 são reservadas para serviços privilégios. A porta 0 é a única porta que não pode ser alterada por que é reservada para o protocolo TCP/IP

para acessar um serviço, precisamos nos conectar usando o endereço ip e a porta. Existem várias ferramentas para enumeração de portas e serviços

## Nmap (network mapper)
é a principal ferramenta, o comando padrão do nmap é


```
$ nmap 10.129.42.253

Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-25 16:07 EST
Nmap scan report for 10.129.42.253
Host is up (0.11s latency).
Not shown: 995 closed ports
PORT    STATE SERVICE
21/tcp  open  ftp
22/tcp  open  ssh
80/tcp  open  http
139/tcp open  netbios-ssn
445/tcp open  microsoft-ds
```

Esse é um exemplo de saída. Por padrão, no comando básico o nmap não faz verificação das portas UDP 

O estado das portas confirma que elas estão abertas, as vezes as portas podem ser listadas com o status filtered (filtrada). Isso vai acontecer se o firewall estiver bloqueando ou permitindo acesso a porta de endereços especificos

Algumas portas podem ser associadas a sistemas operacionais, a 445 por exemplo é exclusiva do windows (Se não for alterada)

O parâmetro `-sC` do nmap é usado para utilização de scripts para obter mais informações. o parâmetro `-sV` faz uma varredura de versão usando uma assinatura digital do serviço, esse tipo de varredura é feita com um banco de dados de mais de 1000 assinaturas diferentes, o parâmetro `-p-` manda o nmap analizar todas as 65.535 portas

saída esperada:

```
$ nmap -sV -sC -p- 10.129.42.253

Starting Nmap 7.80 ( https://nmap.org ) at 2021-02-25 16:18 EST
Nmap scan report for 10.129.42.253
Host is up (0.11s latency).
Not shown: 65530 closed ports
PORT    STATE SERVICE     VERSION
21/tcp  open  ftp         vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed (FTP code 230)
|_drwxr-xr-x    2 ftp      ftp          4096 Feb 25 19:25 pub
| ftp-syst: 
|   STAT: 
| FTP server status:
|      Connected to ::ffff:10.10.14.2
|      Logged in as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout in seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 2
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)
80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))
|_http-server-header: Apache/2.4.41 (Ubuntu)
|_http-title: PHP 7.4.3 - phpinfo()
139/tcp open  netbios-ssn Samba smbd 4.6.2
445/tcp open  netbios-ssn Samba smbd 4.6.2
Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_nbstat: NetBIOS name: GS-SVCSCAN, NetBIOS user: <unknown>, NetBIOS MAC: <unknown> (unknown)
| smb2-security-mode: 
|   2.02: 
|_    Message signing enabled but not required
| smb2-time: 
|   date: 2021-02-25T21:21:51
|_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 233.68 seconds
```


escanear 65 mil portas leva muito mais tempo do que levava escaneando mil, as opções -sV e -sC também aumentam o tempo de execução
o cabeçalho *version* ao lado de SERVICE fornece o nome e número da versão de cada serviço

Sabemos que o sistema operacional é ubuntu. versões de aplicações externas podem ajudar a descobrir a versão do OS. Com o ssh por exemplo. Uma pesquisa da versão ``OpenSSH 8.2p1 Ubuntu 4ubuntu0.1`` nos changelogs do openssh, vemos que a versão de lançamento segue o formato ``1:7.3p1-1ubuntu0.1``. levando a nossa versão para esse formato temos ``1:8.2p1-4ubuntu0.1``. outra pesquisa mostra que essa versão está incluída na versão `` Ubuntu Linux Focal Fossa 20.04`` da ubuntu

![[Pasted image 20250225141738.png]]

Outra pesquisa mostra que a versão é de 23 de abril de 2020

![[Pasted image 20250225142237.png]]

**Observação: a referência cruzada pode não ser eficaz em alguns casos pela possibilidade de instalar serviços mais recentes em sistemas operacionais mais antigos**

-sC scan reporta os cabeçalhos do servidor (http-server-header) e titulo (http-title) de qualquer página hospedada no servidor web

o header revela que o cliente do servidor é o `Apache/2.4.41 (Ubuntu)` e o único titulo é 
``PHP 7.4.3 - phpinfo()``, esse título indica que é um arquivo phpinfo que é criado manualmente para verificar a instalação do PHP. O título revela a versão do php

![[Pasted image 20250225215720.png]]

A sintaxe para usar um script nmap individual é
`nmap --script <nome do script> -p<porta> <host>`

Nmap pode fazer um banner grabbing com a sintaxe `nmap -sV --script=banner <alvo>`, o netcat também faz o mesmo `nc -nv <alvo> <porta>`

## FTP

Aula sobre o protocolo FTP [prot1_ftp](prot1_ftp.md)

## SMB
Aula sobre o protocolo SMB [prot2_smb](prot2_smb.md)
##  SNMP
Aula sobre o protocolo SNMP [prot3_snmp](prot3_snmp.md)

[próxima aula](7_enumeração_web.md)
